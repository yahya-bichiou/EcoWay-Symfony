{% extends 'base.html.twig' %}

{% block title %}Depot index{% endblock %}

{% block body %}
  <!-- ***** Header Area Start ***** -->
  <header class="header-area header-sticky wow slideInDown" data-wow-duration="0.75s" data-wow-delay="0s">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <nav class="main-nav">
            <!-- ***** Logo Start ***** -->
            <a href="index.html" class="logo">
              <img src="{{ asset('logo.png') }}" alt="Logo">
            </a>
            <!-- ***** Logo End ***** -->
            <!-- ***** Menu Start ***** -->
            <ul class="nav">
              <li class="scroll-to-section"><a href="index.html">Home</a></li>
              <li class="scroll-to-section"><a href="/front/dropoff" class="active">Dépots</a></li>
              <li class="scroll-to-section"><a href="/front/product">Produits</a></li>
              <li class="scroll-to-section"><a href="/front/product">Boutique</a></li>
              <li class="scroll-to-section"><a href="/front/blog">Blog</a></li>
              <li class="scroll-to-section"><a href="/front/event">Event</a></li>
              <li class="scroll-to-section"><a href="/front/user">Users</a></li>
            </ul>
            <a class='menu-trigger'>
              <span>Menu</span>
            </a>
            <!-- ***** Menu End ***** -->
          </nav>
        </div>
      </div>
    </div>
  </header>
  <!-- ***** Header Area End ***** -->

  <!-- Main Content Section -->
  <section class="single-product">
    <div class="container">
      <div class="row mt-5">
        <!-- Image Section -->
        <div class="col-md-5">
          <div class="single-product-slider" style="height: 50%;">
            <div id="carousel-custom" class="carousel slide h-100" data-ride="carousel">
              <div class="carousel-item active h-100">
                <img src="{{ asset('uploads/' ~ depot.image) }}" alt="Depot Image" class="img-fluid rounded shadow h-100 w-100" style="object-fit: cover;">
              </div>
            </div>
          </div>
        </div>

        <!-- Details Section -->
        <div class="col-md-7">
          <div class="single-product-details">
            <h2 class="mb-4">{{ depot.nom }}</h2>
            <div class="details-table mb-4">
              <table class="table">
                <tbody>
                  <tr>
                    <td><h5>Adresse:</h5></td>
                    <td><p class="product-price">{{ depot.adresse }}</p></td>
                  </tr>
                  <tr>
                    <td><h5>Capacité:</h5></td>
                    <td><p class="product-price">{{ depot.capacite }}</p></td>
                  </tr>
                </tbody>
              </table>
              <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
              <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
              <div id="map" style="height: 500px;"></div>
              <script>
        document.addEventListener("DOMContentLoaded", function () {
            fetch(`/depot/api/{{ depot.id }}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                        return;
                    }

                    // Initialize the map with depot coordinates
                    var map = L.map('map').setView([data.latitude, data.longitude], 13);

                    // Add OpenStreetMap tiles
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; OpenStreetMap contributors'
                    }).addTo(map);

                    // Add a marker for the depot
                    L.marker([data.latitude, data.longitude]).addTo(map)
                        .bindPopup(`<b>${data.name}</b><br>Status: ${data.status}`)
                        .openPopup();
                })
                .catch(error => console.error("Error fetching depot data:", error));
        });
    </script>
            </div>

            <!-- Form Section -->
            <div class="collection-form">
              {% include "/collecte/new.html.twig" %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer Section -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <p>Copyright © 2025 ECOWAY. All Rights Reserved</p>
        </div>
      </div>
    </div>
  </footer>
{% endblock %}